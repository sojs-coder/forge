# Spritesheet JSON Format

The `AnimatedSprite` component relies on a specific JSON format to understand how to slice a spritesheet image and play animations. This document details that format.

While you can create this JSON by hand, it is often generated by tools like [TexturePacker](https://www.codeandweb.com/texturepacker).

## Top-Level Structure

The JSON file should be an object with two main keys: `frames` and `meta`.

```json
{
  "frames": [ ... ],
  "meta": { ... }
}
```

---

## The `frames` Array

This is an array of objects, where each object represents a single frame on your spritesheet image. The engine uses this array to look up frame data by index.

Each frame object has the following properties:

-   `filename: string`: The unique name for this frame (e.g., `"run-0.png"`).
-   `frame: {x, y, w, h}`: The coordinates and dimensions of this frame within the spritesheet image file.
    -   `x`: The x-coordinate of the top-left corner.
    -   `y`: The y-coordinate of the top-left corner.
    -   `w`: The width of the frame.
    -   `h`: The height of the frame.
-   `rotated: boolean`: Whether the frame is rotated 90 degrees in the spritesheet. The engine handles this automatically.
-   `trimmed: boolean`: Whether whitespace has been trimmed from the original sprite. The engine uses the `spriteSourceSize` and `sourceSize` to reconstruct the original sprite.
-   `spriteSourceSize: {x, y, w, h}`: The dimensions of the trimmed sprite within its original, untrimmed bounding box.
-   `sourceSize: {w, h}`: The dimensions of the original, untrimmed sprite.
-   `duration: number`: (Optional) The duration of this specific frame in milliseconds. Defaults to 100ms if not provided.

### `frames` Example

```json
"frames": [
  {
    "filename": "walk-0.png",
    "frame": {"x":1,"y":1,"w":32,"h":32},
    "rotated": false,
    "trimmed": false,
    "spriteSourceSize": {"x":0,"y":0,"w":32,"h":32},
    "sourceSize": {"w":32,"h":32},
    "duration": 150
  }
]
```

---

## The `meta` Object

This object contains metadata about the entire spritesheet and defines the animations.

-   `image: string`: The filename of the spritesheet image (e.g., `"my_sprites.png"`). This path should be relative to the JSON file itself.
-   `size: {w, h}`: The total width and height of the spritesheet image file.
-   `startingAnimation?: string`: (Optional) The name of the animation that should play by default when the `AnimatedSprite` is created.
-   `animations: { [name: string]: Animation }`: An object where each key is the name of an animation (e.g., `"walk"`, `"idle"`), and the value is an `Animation` object.

### The `Animation` Object

-   `frames: string[]`: An array of `filename` strings (which must match filenames in the top-level `frames` array) that specifies the sequence of frames for this animation.
-   `loop?: boolean`: (Optional) `true` if the animation should loop, `false` if it should play once. Defaults to `true`.
-   `bounce?: boolean`: (Optional) `true` if the animation should play forwards and then in reverse. Defaults to `false`.

### `meta` Example

```json
"meta": {
  "image": "my_character.png",
  "size": {"w":128,"h":64},
  "startingAnimation": "idle",
  "animations": {
    "idle": {
      "frames": ["idle-0.png", "idle-1.png", "idle-2.png"],
      "loop": true
    },
    "run": {
      "frames": ["run-0.png", "run-1.png", "run-2.png", "run-3.png"],
      "loop": true
    },
    "attack": {
      "frames": ["attack-0.png", "attack-1.png"],
      "loop": false
    }
  }
}
```

---

## Using with TexturePacker

If you use TexturePacker, you can generate a compatible JSON file automatically.

1.  Organize your frames into folders where each folder name is the name of an animation (e.g., `/walk/walk-0.png`, `/idle/idle-0.png`).
2.  When you export, choose the **JSON (Array)** data format.
3.  The engine provides a helper function, `convertTexturePackerToSpriteSheetData`, if the format is slightly different, but the modern JSON (Array) format should work out of the box.
