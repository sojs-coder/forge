<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <script type = "module">
        import * as Forge from '/engine/bundle.js';


        const { Vector, PolygonCollider, Part, GameObject, Game, Scene, Layer, PhysicsBody, PhysicsEngine, ColorRender, Transform, BoxCollider, Camera} = Forge;


        const game = new Game({
            name: "my game",
            canvas: document.getElementById('gameCanvas'),
            width: 800,
            height: 600,
            showFrameStats: "BASIC"
        });

        const scene = new Scene({
            name: "scene 1"
        });

        const pe = new PhysicsEngine({
            gravity: {
                x: 0, 
                y: 1,
                scale: 0.001
            }
        });
        const camera = new Camera({
            name: "cam1"
        });

        const l1 = new Layer({
            name: "layer 1",
        });

        class PolySpawner extends Part {
            constructor({ name, bottomRange, topRange, polyParent }) {
                super({ name });
                this.bottomRange = bottomRange;
                this.topRange = topRange;
                this.spawned = false;
              	this.polyParent = polyParent;
            }
 
			static singular = true;
            static properties = {
                name: { type: "text", default: "Part" },
                bottomRange: { type: "number", default: 0 },
                topRange: { type: "number", default: 100 },
                polyParent: { type: "Part", default: null, subType: "Layer" },
            };
            randomPolygonPoints(sides, radius) {
                const points = [];
                const angleStep = (Math.PI * 2) / sides;
                for (let i = 0; i < sides; i++) {
                    const angle = i * angleStep;
                    points.push(new Vector(
                        Math.cos(angle) * radius,
                        Math.sin(angle) * radius
                    ));
                }
                return points;
            }
            act(d) {
                super.act(d);
                if (!this.spawned) {
                    this.spawned = true;
                    // Spawn the polygons
                    const numPolygons = Math.floor(Math.random() * (this.topRange - this.bottomRange + 1)) + this.bottomRange;
                    for (let i = 0; i < numPolygons; i++) {
                        const sides = Math.floor(Math.random() * 5) + 3; // 3 to 7 sides
                        const radius = Math.random() * 40 + 20; // 20 to 60 px
                        const x = Math.random() * (this.top.width - 100) + 50;
                        const y = Math.random() * 200 + 50;
                        const color = `hsl(${Math.random() * 360}, 80%, 60%)`;

                        const nGon = new GameObject({
                            name: `nGon${i}`
                        });
                        const points = this.randomPolygonPoints(sides, radius);
                        nGon.addChildren(
                            new Transform({
                                position: new Vector(x, y),
                                rotation: Math.random() * Math.PI * 2
                            }),
                            new PolygonCollider({
                                vertices: points,
                            }),
                            new ColorRender({
                                vertices: points,
                                color: color
                            }),
                            new PhysicsBody({
                                isStatic: false,
                                restitution: 0.5, // Bounciness
                            })
                        );
                        // Add components to the polygon
                        this.polyParent.addChild(nGon);
                    }
                }
            }
        }

        const polySpawner = new PolySpawner({
            name: "polySpawner",
            bottomRange: 1,
            topRange: 5,
            polyParent: l1
        });

        const go = new GameObject({
            name: "block"
        });

        const transform = new Transform({
            position: new Vector(0, 300),
            rotation: 0,
            scale: Vector.From(1)
        });
        const cr = new ColorRender({
            width: 300,
            height: 50,
            color: "red"
        })
        const bc = new BoxCollider({
            width: 300,
            height: 50
        });
        const pb = new PhysicsBody({
            isStatic: true,
            restitution: 0.8
        });

        go.addChildren(transform, cr, bc, pb);
        l1.addChild(go);

        scene.addChildren(pe, camera, l1, polySpawner);

        game.addChild(scene);

        game.start();
    </script>
</body>
</html>