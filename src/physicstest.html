<!DOCTYPE html>
<html>

<head>
    <title>Physics Test</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>
    <canvas id="gamecanvas"></canvas>
    <script type="module">
        import { Game, Scene, Layer, Vector, PhysicsEngine, GameObject, Transform, BoxCollider, PolygonCollider, ColorRender, PhysicsBody } from "../engine/bundle.js";

        const game = new Game({
            width: window.innerWidth,
            height: window.innerHeight,
            devmode: false,
            canvas: "gamecanvas",
        });

        const scene = new Scene({
            name: "Main Scene",
            backgroundColor: "#000000"
        });
        const layer = new Layer({
            name: "Layer 1"
        });
        game.addChild(scene);
        scene.addChild(layer);

        const physicsEngine = new PhysicsEngine({
            gravity: { x: 0, y: 1, }
        });

        scene.addChild(physicsEngine);

        // Helper to generate random polygon points
        function randomPolygonPoints(sides, radius) {
            const points = [];
            const angleStep = (Math.PI * 2) / sides;
            for (let i = 0; i < sides; i++) {
                const angle = i * angleStep;
                points.push(new Vector(
                    Math.cos(angle) * radius,
                    Math.sin(angle) * radius
                ));
            }
            return points;
        }

        // Spawn random amount of polygons fomr [10, 100]
        const numPolygons = Math.floor(Math.random() * 90) + 10;
        for (let i = 0; i < numPolygons; i++) {
            const sides = Math.floor(Math.random() * 5) + 3; // 3 to 7 sides
            const radius = Math.random() * 40 + 20; // 20 to 60 px
            const x = Math.random() * (game.width - 100) + 50;
            const y = Math.random() * 200 + 50;
            const color = `hsl(${Math.random() * 360}, 80%, 60%)`;

            const nGon = new GameObject({
                name: `nGon${i}`
            });
            const points = randomPolygonPoints(sides, radius);
            nGon.addChildren(
                new Transform({
                    position: new Vector(x, y),
                    rotation: Math.random() * Math.PI * 2
                }),
                new PolygonCollider({
                    vertices: points,
                }),
                new ColorRender({
                    vertices: points,
                    color: color
                }),
                new PhysicsBody({
                    isStatic: false,
                    restitution: 0.5, // Bounciness
                })
            );

            layer.addChild(nGon);
        }

        // Ground
        const ground = new GameObject({
            name: "Ground"
        });
        ground.addChildren(
            new Transform({
                position: new Vector(game.width / 2, game.height - 25)
            }),
            new BoxCollider({
                width: game.width - 60,
                height: 50
            }),
            new ColorRender({
                width: game.width - 60,
                height: 50,
                color: "#00ff00"
            }),
            new PhysicsBody({
                isStatic: true
            })
        );

        layer.addChild(ground);

        game.start();


    </script>
</body>

</html>